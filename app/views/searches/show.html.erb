<h1>Поиск билета</h1>

<p>
  <%= form_tag search_path, method: :post do %>
  <div f.field >
    
    <%= label_tag :base_station, 'Выбрать станцию отправления' %>
    <%= select_tag :base_station_id, options_from_collection_for_select(RailwayStation.all, :id, :title, {})  %>  
    <%= label_tag :end_station, 'Выбрать станцию назначения' %>
    <%= select_tag :end_station_id, options_from_collection_for_select(RailwayStation.all, :id, :title, {})  %> 
 </div>

  <div f.actions >  
    <%= submit_tag "Найти" %>  
 </div>
  <% end %>
  
<p>
  <% if @route.nil? || @route.empty? %>
      Маршрут не найден
</p>
      <% else %>
     Поезда на маршруте:
          <% @trains = [] %>
          <% if @route.class == Route %>
            <% @trains << @route.trains %>
            <% else %>
              <% @route.each do |route| %>
                 <% @trains << route.trains %>
              <% end %>
              <% @trains.flatten! %>
          <% end %>
       <% if @trains.empty? %>
          На маршруте нет поездов
<p>
          <% else %>
          
          <%= @base_station.title %>
          -
          <%= @end_station.title %>
<table>
      <thead>
       <tr>
        <td>Номер поезда</td>
        <td>Время отправления</td>
        <td>Время прибытия</td>
        <td>  </td>
       
       </tr>
      </thead>
    <tbody>
     <% @trains.each do |train| %>
      <tr>
       <td><%= train.number %></td>
       <td><%= @base_station.departure_time_in(train.route) %></td>
       <td><%= @end_station.arrival_time_in(train.route) %></td> 
   
   <td>
   <%= form_tag new_ticket_path, method: :get do %>
 
 
   <%= hidden_field_tag :train_id, train.id %>
   <%= hidden_field_tag :base_station, @base_station %>
   <%= hidden_field_tag :end_station, @end_station %>
   <%= hidden_field_tag :ticket_user_id, @user %>
  
   <%= link_to 'Купить билет', new_ticket_path %>
   
 <% end %>
   </td>  
  </tr>
 <% end %>
     
 </tbody>
</table>
  <% end %>
<% end %>
